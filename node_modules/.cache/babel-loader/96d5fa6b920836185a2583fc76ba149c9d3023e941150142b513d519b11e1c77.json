{"ast":null,"code":"import { _optionalChain } from '@sentry/utils/esm/buildPolyfills';\nimport { loadModule, logger, fill } from '@sentry/utils';\nimport { shouldDisableAutoInstrumentation } from './utils/node-utils.js';\n\n/** Tracing integration for node-mysql package */\nclass Mysql {\n  constructor() {\n    Mysql.prototype.__init.call(this);\n  }\n  /**\n   * @inheritDoc\n   */\n  static __initStatic() {\n    this.id = 'Mysql';\n  }\n\n  /**\n   * @inheritDoc\n   */\n  __init() {\n    this.name = Mysql.id;\n  }\n\n  /** @inheritdoc */\n  loadDependency() {\n    return this._module = this._module || loadModule('mysql/lib/Connection.js');\n  }\n\n  /**\n   * @inheritDoc\n   */\n  setupOnce(_, getCurrentHub) {\n    if (shouldDisableAutoInstrumentation(getCurrentHub)) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.log('Mysql Integration is skipped because of instrumenter configuration.');\n      return;\n    }\n    const pkg = this.loadDependency();\n    if (!pkg) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error('Mysql Integration was unable to require `mysql` package.');\n      return;\n    }\n\n    // The original function will have one of these signatures:\n    //    function (callback) => void\n    //    function (options, callback) => void\n    //    function (options, values, callback) => void\n    fill(pkg, 'createQuery', function (orig) {\n      return function (options, values, callback) {\n        const scope = getCurrentHub().getScope();\n        const parentSpan = _optionalChain([scope, 'optionalAccess', _2 => _2.getSpan, 'call', _3 => _3()]);\n        const span = _optionalChain([parentSpan, 'optionalAccess', _4 => _4.startChild, 'call', _5 => _5({\n          description: typeof options === 'string' ? options : options.sql,\n          op: 'db',\n          data: {\n            'db.system': 'mysql'\n          }\n        })]);\n        if (typeof callback === 'function') {\n          return orig.call(this, options, values, function (err, result, fields) {\n            _optionalChain([span, 'optionalAccess', _6 => _6.finish, 'call', _7 => _7()]);\n            callback(err, result, fields);\n          });\n        }\n        if (typeof values === 'function') {\n          return orig.call(this, options, function (err, result, fields) {\n            _optionalChain([span, 'optionalAccess', _8 => _8.finish, 'call', _9 => _9()]);\n            values(err, result, fields);\n          });\n        }\n        return orig.call(this, options, values, callback);\n      };\n    });\n  }\n}\nMysql.__initStatic();\nexport { Mysql };","map":{"version":3,"names":["Mysql","constructor","prototype","__init","call","__initStatic","id","name","loadDependency","_module","loadModule","setupOnce","_","getCurrentHub","shouldDisableAutoInstrumentation","__SENTRY_DEBUG__","logger","log","pkg","error","fill","orig","options","values","callback","scope","getScope","parentSpan","_optionalChain","_2","getSpan","_3","span","_4","startChild","_5","description","sql","op","data","err","result","fields","_6","finish","_7","_8","_9"],"sources":["/Users/chirag_vaid/Desktop/Pesto/team-anil-rao-p8-team-anil-rao/node_modules/@sentry-internal/src/node/integrations/mysql.ts"],"sourcesContent":["import type { Hub } from '@sentry/core';\nimport type { EventProcessor } from '@sentry/types';\nimport { fill, loadModule, logger } from '@sentry/utils';\n\nimport type { LazyLoadedIntegration } from './lazy';\nimport { shouldDisableAutoInstrumentation } from './utils/node-utils';\n\ninterface MysqlConnection {\n  createQuery: () => void;\n}\n\n/** Tracing integration for node-mysql package */\nexport class Mysql implements LazyLoadedIntegration<MysqlConnection> {\n  /**\n   * @inheritDoc\n   */\n  public static id: string = 'Mysql';\n\n  /**\n   * @inheritDoc\n   */\n  public name: string = Mysql.id;\n\n  private _module?: MysqlConnection;\n\n  /** @inheritdoc */\n  public loadDependency(): MysqlConnection | undefined {\n    return (this._module = this._module || loadModule('mysql/lib/Connection.js'));\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public setupOnce(_: (callback: EventProcessor) => void, getCurrentHub: () => Hub): void {\n    if (shouldDisableAutoInstrumentation(getCurrentHub)) {\n      __DEBUG_BUILD__ && logger.log('Mysql Integration is skipped because of instrumenter configuration.');\n      return;\n    }\n\n    const pkg = this.loadDependency();\n\n    if (!pkg) {\n      __DEBUG_BUILD__ && logger.error('Mysql Integration was unable to require `mysql` package.');\n      return;\n    }\n\n    // The original function will have one of these signatures:\n    //    function (callback) => void\n    //    function (options, callback) => void\n    //    function (options, values, callback) => void\n    fill(pkg, 'createQuery', function (orig: () => void) {\n      return function (this: unknown, options: unknown, values: unknown, callback: unknown) {\n        const scope = getCurrentHub().getScope();\n        const parentSpan = scope?.getSpan();\n        const span = parentSpan?.startChild({\n          description: typeof options === 'string' ? options : (options as { sql: string }).sql,\n          op: 'db',\n          data: {\n            'db.system': 'mysql',\n          },\n        });\n\n        if (typeof callback === 'function') {\n          return orig.call(this, options, values, function (err: Error, result: unknown, fields: unknown) {\n            span?.finish();\n            callback(err, result, fields);\n          });\n        }\n\n        if (typeof values === 'function') {\n          return orig.call(this, options, function (err: Error, result: unknown, fields: unknown) {\n            span?.finish();\n            values(err, result, fields);\n          });\n        }\n\n        return orig.call(this, options, values, callback);\n      };\n    });\n  }\n}\n"],"mappings":";;;;AAWA;AACA,MAAAA,KAAA;EAAAC,YAAA;IAAAD,KAAA,CAAAE,SAAA,CAAAC,MAAA,CAAAC,IAAA;EAAA;EACA;;;EAGA,OAAAC,aAAA;IAAA,KAAAC,EAAA;EAAA;;EAEA;;;EAGAH,OAAA;IAAA,KAAAI,IAAA,GAAAP,KAAA,CAAAM,EAAA;EAAA;;EAIA;EACAE,eAAA;IACA,YAAAC,OAAA,QAAAA,OAAA,IAAAC,UAAA;EACA;;EAEA;;;EAGAC,UAAAC,CAAA,EAAAC,aAAA;IACA,IAAAC,gCAAA,CAAAD,aAAA;MACA,QAAAE,gBAAA,oBAAAA,gBAAA,KAAAC,MAAA,CAAAC,GAAA;MACA;IACA;IAEA,MAAAC,GAAA,QAAAV,cAAA;IAEA,KAAAU,GAAA;MACA,QAAAH,gBAAA,oBAAAA,gBAAA,KAAAC,MAAA,CAAAG,KAAA;MACA;IACA;;IAEA;IACA;IACA;IACA;IACAC,IAAA,CAAAF,GAAA,2BAAAG,IAAA;MACA,iBAAAC,OAAA,EAAAC,MAAA,EAAAC,QAAA;QACA,MAAAC,KAAA,GAAAZ,aAAA,GAAAa,QAAA;QACA,MAAAC,UAAA,GAAAC,cAAA,EAAAH,KAAA,oBAAAI,EAAA,IAAAA,EAAA,CAAAC,OAAA,UAAAC,EAAA,IAAAA,EAAA;QACA,MAAAC,IAAA,GAAAJ,cAAA,EAAAD,UAAA,oBAAAM,EAAA,IAAAA,EAAA,CAAAC,UAAA,UAAAC,EAAA,IAAAA,EAAA;UACAC,WAAA,SAAAd,OAAA,gBAAAA,OAAA,GAAAA,OAAA,CAAAe,GAAA;UACAC,EAAA;UACAC,IAAA;YACA;UACA;QACA;QAEA,WAAAf,QAAA;UACA,OAAAH,IAAA,CAAAjB,IAAA,OAAAkB,OAAA,EAAAC,MAAA,YAAAiB,GAAA,EAAAC,MAAA,EAAAC,MAAA;YACAd,cAAA,EAAAI,IAAA,oBAAAW,EAAA,IAAAA,EAAA,CAAAC,MAAA,UAAAC,EAAA,IAAAA,EAAA;YACArB,QAAA,CAAAgB,GAAA,EAAAC,MAAA,EAAAC,MAAA;UACA;QACA;QAEA,WAAAnB,MAAA;UACA,OAAAF,IAAA,CAAAjB,IAAA,OAAAkB,OAAA,YAAAkB,GAAA,EAAAC,MAAA,EAAAC,MAAA;YACAd,cAAA,EAAAI,IAAA,oBAAAc,EAAA,IAAAA,EAAA,CAAAF,MAAA,UAAAG,EAAA,IAAAA,EAAA;YACAxB,MAAA,CAAAiB,GAAA,EAAAC,MAAA,EAAAC,MAAA;UACA;QACA;QAEA,OAAArB,IAAA,CAAAjB,IAAA,OAAAkB,OAAA,EAAAC,MAAA,EAAAC,QAAA;MACA;IACA;EACA;AACA;AAAAxB,KAAA,CAAAK,YAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}